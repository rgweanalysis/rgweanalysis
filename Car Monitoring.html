<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Tahoma, sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .topbar {
      background: linear-gradient(135deg, #020617, #0f172a);
      border-bottom: 1px solid #1f2937;
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(16px);
    }

    .container {
      max-width: 1700px;
      margin: 0 auto;
      padding: 0 1.25rem 1.5rem;
    }

    .topbar-inner {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1.5rem;
    }

    
    .topbar-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .topbar-brand img {
      height: 48px;
      max-width: 180px;
      object-fit: contain;
      display: block;
    }

.app-title {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 700;
    }

    .app-subtitle {
      margin: 0.35rem 0 0;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .layout {
      margin-top: 1.5rem;
      display: grid;
      grid-template-columns: minmax(0, 0.4fr) minmax(0, 2.4fr);
      gap: 1.5rem;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.08), transparent 55%), #020617;
      border-radius: 1rem;
      border: 1px solid #1e293b;
      box-shadow: 0 18px 45px rgba(15,23,42,0.7);
      padding: 1.25rem 1.4rem 1.4rem;
    }

    .card-header {
      margin-bottom: 1rem;
    }

    .card-header h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .card-header .muted {
      margin-top: 0.35rem;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .muted {
      color: #9ca3af;
      font-size: 0.85rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.9rem 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.85rem;
    }

    .form-group-full {
      grid-column: 1 / -1;
    }

    label {
      font-weight: 500;
    }

    input, select, textarea {
      border-radius: 0.6rem;
      border: 1px solid #1e293b;
      background: #020617;
      color: #e5e7eb;
      padding: 0.45rem 0.6rem;
      font: inherit;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
    }

    input[type="number"] {
      direction: ltr;
      text-align: right;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .form-actions {
      margin-top: 1rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      padding: 0.45rem 0.95rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .btn:hover {
      background: #111827;
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(15,23,42,0.7);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn.primary {
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      border-color: transparent;
      color: #020617;
      font-weight: 600;
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, #0284c7, #0ea5e9);
    }

    .btn-small {
      padding: 0.28rem 0.7rem;
      font-size: 0.8rem;
    }

    .btn-danger {
      border-color: #b91c1c;
    }

    .btn-danger:hover {
      background: #7f1d1d;
      border-color: #f87171;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      border-radius: 0.85rem;
      border: 1px solid #1f2937;
      padding: 0.6rem 0.8rem;
      background: radial-gradient(circle at top right, rgba(59,130,246,0.16), transparent 55%);
    }

    .stat-label {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .stat-value {
      margin-top: 0.3rem;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: flex-end;
      margin-bottom: 0.9rem;
    }

    .filter-group {
      min-width: min(220px, 100%);
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .filter-group input {
      min-width: 200px;
    }

    .report-actions {
      margin-bottom: 0.9rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .card-header-actions {
      margin-top: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.75);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .modal {
      background: #020617;
      border-radius: 1rem;
      border: 1px solid #1f2937;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      padding: 1.25rem 1.5rem 1.5rem;
      box-shadow: 0 25px 60px rgba(0,0,0,0.75);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .modal-title {
      margin: 0;
      font-size: 1rem;
    }

    .modal-close {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .modal-body {
      font-size: 0.85rem;
    }

    .modal-footer {
      margin-top: 1rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    .weekly-table-wrapper {
      margin-top: 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      overflow: auto;
    }

    .weekly-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
      font-size: 0.8rem;
    }

    .weekly-table th,
    .weekly-table td {
      padding: 0.45rem 0.5rem;
      border-bottom: 1px solid #111827;
      text-align: right;
    }

    .weekly-table thead {
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .weekly-table input[type="number"] {
      width: 100%;
      box-sizing: border-box;
    }

    .table-wrapper {
      border-radius: 0.9rem;
      border: 1px solid #1f2937;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 720px;
      font-size: 0.82rem;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 0.55rem 0.6rem;
      border-bottom: 1px solid #111827;
      text-align: right;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      color: #9ca3af;
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.7);
    }

    tbody tr:nth-child(odd) {
      background: rgba(15,23,42,0.4);
    }

    .row-overdue {
      box-shadow: inset 3px 0 0 #ef4444;
    }

    .row-near {
      box-shadow: inset 3px 0 0 #eab308;
    }

    .status-badge {
      border-radius: 999px;
      padding: 0.12rem 0.55rem;
      font-size: 0.74rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      border: 1px solid transparent;
    }

    .status-ok {
      background: rgba(22,163,74,0.2);
      border-color: rgba(22,163,74,0.6);
      color: #bbf7d0;
    }

    .status-near {
      background: rgba(234,179,8,0.15);
      border-color: rgba(234,179,8,0.6);
      color: #facc15;
    }

    .status-overdue {
      background: rgba(248,113,113,0.18);
      border-color: rgba(248,113,113,0.7);
      color: #fecaca;
    }

    .status-unknown {
      background: rgba(148,163,184,0.14);
      border-color: rgba(148,163,184,0.6);
      color: #e5e7eb;
    }

    .small-date {
      margin-top: 0.1rem;
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .tag {
      border-radius: 999px;
      padding: 0.12rem 0.55rem;
      font-size: 0.74rem;
      border: 1px solid #1f2937;
    }

    .tag-good {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.6);
    }

    .tag-check {
      background: rgba(234,179,8,0.15);
      border-color: rgba(234,179,8,0.6);
    }

    .tag-replace {
      background: rgba(248,113,113,0.18);
      border-color: rgba(248,113,113,0.7);
    }

    .tag-unknown {
      background: rgba(148,163,184,0.14);
      border-color: rgba(148,163,184,0.6);
    }

    .empty-row {
      text-align: center;
      color: #9ca3af;
    }
  

    .topbar-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    body.light-mode {
      background: radial-gradient(circle at top left, #e0f2fe 0, #ecfeff 35%, #f9fafb 65%, #fefce8 100%);
      color: #111827;
      color-scheme: light;
    }

    body.light-mode .topbar {
      background: linear-gradient(135deg, #ffffff, #e5e7eb);
      border-bottom-color: #d1d5db;
    }

    body.light-mode .card,
    body.light-mode .modal {
      background: rgba(255,255,255,0.96);
      border-color: #dbeafe;
      box-shadow: 0 18px 45px rgba(15,23,42,0.12);
    }

    body.light-mode .card-add-vehicle {
      background: linear-gradient(135deg, #f0f9ff, #eff6ff);
      border-color: #7dd3fc;
    }

    body.light-mode .card-add-vehicle .card-header {
      border-bottom-color: rgba(125, 211, 252, 0.7);
    }

    body.light-mode .card-add-vehicle #form-title {
      color: #0369a1;
    }

    body.light-mode .card-add-vehicle .muted {
      color: #0ea5e9;
    }

    body.light-mode .app-subtitle,
    body.light-mode .muted,
    body.light-mode .small-date,
    body.light-mode .stat-sub {
      color: #6b7280;
    }

    body.light-mode input,
    body.light-mode select,
    body.light-mode textarea {
      background: #ffffff;
      border-color: #d1d5db;
      color: #111827;
    }

    body.light-mode input::placeholder,
    body.light-mode textarea::placeholder {
      color: #9ca3af;
    }

    body.light-mode .table-wrapper {
      border-color: #dbeafe;
    }

    body.light-mode thead {
      background: #eff6ff;
    }

    body.light-mode tbody tr:nth-child(even) {
      background: #f0f9ff;
    }

    body.light-mode th,
    body.light-mode td {
      border-bottom-color: #e5e7eb;
    }

    body.light-mode .empty-row {
      color: #6b7280;
    }

    body.light-mode .modal-backdrop {
      background: rgba(15,23,42,0.35);
    }

    body.light-mode .badge {
      border-color: #e5e7eb;
      background: #f9fafb;
    }

    .site-footer {
      margin-top: 2rem;
      border-top: 1px solid #1f2937;
      padding: 1rem 0.75rem;
      font-size: 0.9rem;
      text-align: center;
      color: #9ca3af;
    }
    body.light-mode .site-footer {
      border-top-color: #e5e7eb;
      color: #6b7280;
    }

  </style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="login-container" style="min-height:100vh;display:flex;align-items:center;justify-content:center;">
    <form id="login-form" class="card" style="max-width:360px;width:100%;text-align:right;">
      <h2 style="margin-top:0;margin-bottom:0.75rem;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p class="muted">Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù….</p>

      <div class="form-group">
        <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <input type="text" id="username" required />
      </div>

      <div class="form-group">
        <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
        <input type="password" id="password" required />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn primary">Ø¯Ø®ÙˆÙ„</button>
      </div>
    </form>
  </div>

  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div id="app-container" style="display:none;">

  <header class="topbar">
    <div class="container topbar-inner">
      <div class="topbar-brand">
        <img src="data:image/jpeg;base64,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" alt="Ras Ghareb Wind Energy S.A.E logo" />
        <div>
          <h1 class="app-title">Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</h1>
          <p class="app-subtitle">
            Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§ØªØŒ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ Ø§Ù„ØªØ£Ù…ÙŠÙ†ØŒ Ø§Ù„Ø±Ø®ØµØ©ØŒ ÙˆØ­Ø§Ù„Ø© Ø§Ù„ÙƒØ§ÙˆØªØ´.
          </p>
        </div>
      </div>
      <div class="topbar-actions">
        <button id="themeToggle" class="btn btn-small" type="button">â˜€ï¸ ÙˆØ¶Ø¹ ÙØ§ØªØ­</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="layout">
      <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
      <div class="card card-add-vehicle">
        <div class="card-header">
          <h2 id="form-title">Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
          <p class="muted">Ø³Ø¬Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§ØªØŒ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª.</p>
        </div>
        <form id="vehicle-form">
          <input type="hidden" id="vehicleIndex" name="vehicleIndex" />
          <div class="form-grid">
            <div class="form-group">
              <label for="plateNumber">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© *</label>
              <input type="text" id="plateNumber" name="plateNumber" required />
            </div>
            <div class="form-group">
              <label for="carType">Ù†ÙˆØ¹ / Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
              <input type="text" id="carType" name="carType" required />
            </div>
            <div class="form-group">
              <label for="driverName">Ø§Ù„Ø³Ø§Ø¦Ù‚ / ØµØ§Ø­Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
              <input type="text" id="driverName" name="driverName" required />
            </div>
            <div class="form-group">
              <label for="department">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© / Ø§Ù„Ù‚Ø³Ù…</label>
              <input type="text" id="department" name="department" />
            </div>
            <div class="form-group">
              <label for="odometer">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒÙ…) *</label>
              <input type="number" id="odometer" name="odometer" min="0" step="1" required />
            </div>
            <div class="form-group">
              <label for="maintenanceOdometer">Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (ÙƒÙ…)</label>
              <input type="number" id="maintenanceOdometer" name="maintenanceOdometer" min="0" step="1" />
            </div>
            <div class="form-group">
              <label for="lastMaintenanceDate">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØµÙŠØ§Ù†Ø©</label>
              <input type="date" id="lastMaintenanceDate" name="lastMaintenanceDate" />
            </div>
            <div class="form-group">
              <label for="nextMaintenanceDate">ØªØ§Ø±ÙŠØ® Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</label>
              <input type="date" id="nextMaintenanceDate" name="nextMaintenanceDate" />
            </div>
            <div class="form-group">
              <label for="tiresStatus">Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§ÙˆØªØ´</label>
              <select id="tiresStatus" name="tiresStatus">
                <option value="">Ø§Ø®ØªØ±</option>
                <option value="good">Ø¬ÙŠØ¯Ø©</option>
                <option value="check">ØªØ­ØªØ§Ø¬ ÙØ­Øµ</option>
                <option value="replace">ØªØ­ØªØ§Ø¬ ØªØºÙŠÙŠØ±</option>
              </select>
            </div>
            <div class="form-group">
              <label for="insuranceExpiry">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ£Ù…ÙŠÙ†</label>
              <input type="date" id="insuranceExpiry" name="insuranceExpiry" />
            </div>
            <div class="form-group">
              <label for="licenseExpiry">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø±Ø®ØµØ©</label>
              <input type="date" id="licenseExpiry" name="licenseExpiry" />
            </div>
            <div class="form-group">
              <label for="status">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
              <select id="status" name="status">
                <option value="active" selected>Ù†Ø´Ø·Ø©</option>
                <option value="inactive">Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©</option>
              </select>
            </div>
            <div class="form-group form-group-full">
              <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
              <textarea id="notes" name="notes" rows="2"
                placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Ù…Ù„ØŒ Ø£Ø¹Ø·Ø§Ù„ Ù…Ø¹Ø±ÙˆÙØ©ØŒ ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø®Ø§ØµØ©...)"></textarea>
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn primary" id="submit-btn">Ø­ÙØ¸ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
            <button type="button" class="btn" id="resetBtn">ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
          </div>
        </form>
      </div>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
      <div class="card">
        <div class="card-header">
          <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
          <p class="muted">Ø§Ø³ØªØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ Ø§Ù„ØªØ£Ù…ÙŠÙ† ÙˆØ§Ù„Ø±Ø®ØµØ©ØŒ Ù…Ø¹ ÙÙ„ØªØ±Ø© Ø³Ø±ÙŠØ¹Ø©.</p>
          <div class="card-header-actions">
            <button type="button" class="btn btn-small" onclick="openWeeklyModal()">ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯</button>
          </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
            <div class="stat-value" id="total-count">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Ø³ÙŠØ§Ø±Ø§Øª Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù† Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
            <div class="stat-value" id="overdue-count">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Ø³ÙŠØ§Ø±Ø§Øª Ù‚Ø±Ø¨ Ù…ÙˆØ¹Ø¯ ØµÙŠØ§Ù†ØªÙ‡Ø§</div>
            <div class="stat-value" id="near-count">0</div>
          </div>
        </div>

        <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ± -->
        <div class="filter-bar">
          <div class="filter-group">
            <label for="searchInput">Ø¨Ø­Ø«</label>
            <input id="searchInput" type="text"
              placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©ØŒ Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø£Ùˆ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©..." />
          </div>
          <div class="filter-group">
            <label for="statusFilter">Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
            <select id="statusFilter">
              <option value="all">Ø§Ù„ÙƒÙ„</option>
              <option value="overdue">Ù…ØªØ£Ø®Ø±Ø©</option>
              <option value="near">Ù‚Ø±ÙŠØ¨Ø©</option>
              <option value="ok">Ø³Ù„ÙŠÙ…Ø©</option>
              <option value="unknown">ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©</option>
            </select>
          </div>
        </div>

        <!-- ØªÙ‚Ø§Ø±ÙŠØ± PDF -->
        <div class="report-actions">
          <button type="button" class="btn btn-small" onclick="printAllVehicles()">ØªÙ‚Ø±ÙŠØ± ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª (PDF)</button>
          <button type="button" class="btn btn-small" onclick="exportJson()">ØªØµØ¯ÙŠØ± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (JSON)</button>
          <button type="button" class="btn btn-small" onclick="document.getElementById('jsonFileInput').click()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª (JSON)</button>
          <input type="file" id="jsonFileInput" accept="application/json" style="display:none" onchange="importJsonFile(event)">
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
        <div class="table-wrapper">
          <table id="vehicles-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
                <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                <th>Ø§Ù„Ø³Ø§Ø¦Ù‚ / ØµØ§Ø­Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒÙ…)</th>
                <th>Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (ÙƒÙ…)</th>
                <th>Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</th>
                <th>Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§ÙˆØªØ´</th>
                <th>Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
                <th>Ø§Ù„Ø±Ø®ØµØ©</th>
                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
              <!-- ÙŠÙÙ…Ù„Ø£ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:1.5rem;">
      <div class="card-header">
        <h2>ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (Ù‚Ø±Ø§Ø¡Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯)</h2>
        <p class="muted">Ø¹Ø±Ø¶ Ù‚Ø±Ø§Ø¡Ø§Øª Ø¹Ø¯Ø§Ø¯ ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯ Ù„ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµÙÙŠØ© ÙˆØ·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ±.</p>
      </div>
      <div class="filter-bar">
        <div class="filter-group">
          <label for="weeklyPlateFilter">Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
          <select id="weeklyPlateFilter">
            <option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="weeklyFromDate">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="weeklyFromDate" />
        </div>
        <div class="filter-group">
          <label for="weeklyToDate">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="weeklyToDate" />
        </div>
        <div class="filter-group">
          <label>&nbsp;</label>
          <button type="button" class="btn btn-small" onclick="printWeeklyReport()">ØªÙ‚Ø±ÙŠØ± PDF Ù„Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</button>
        </div>
        <div class="filter-group">
          <label>&nbsp;</label>
          <button type="button" class="btn btn-small btn-danger" onclick="clearWeeklyLogsWithPassword()">Ù…Ø³Ø­ ÙƒÙ„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø­Ø¯</button>
        </div>
      </div>
      <div class="weekly-table-wrapper">
        <table class="weekly-table" id="weekly-report-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
              <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
              <th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
              <th>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (ÙƒÙ…)</th>
              <th>Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø¢Ø®Ø± Ù‚Ø±Ø§Ø¡Ø© (ÙƒÙ…)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="7" class="empty-row">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø¡Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="weekly-modal" class="modal-backdrop" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯</h3>
        <button type="button" class="modal-close" onclick="closeWeeklyModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-grid" style="margin-bottom:0.5rem;">
          <div class="form-group">
            <label for="weeklyDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</label>
            <input type="date" id="weeklyDate" />
          </div>
          <div class="form-group">
            <p class="muted">
              Ø£Ø¯Ø®Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„ÙƒÙ„ Ø³ÙŠØ§Ø±Ø© Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹. Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.
            </p>
          </div>
        </div>
        <div class="weekly-table-wrapper">
          <table class="weekly-table" id="weekly-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
                <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                <th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒÙ…)</th>
                <th>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙŠÙˆÙ… (ÙƒÙ…)</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" onclick="closeWeeklyModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="button" class="btn primary" onclick="saveWeeklyLogs()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</button>
      </div>
    </div>
  </div>

  <script>
    let vehicles = [];
    const STORAGE_KEY = 'company_fleet_vehicles';

    let weeklyLogs = [];
    const WEEKLY_STORAGE_KEY = 'company_fleet_weekly_logs';

    const THEME_KEY = 'company_fleet_theme';

    document.addEventListener('DOMContentLoaded', function () {
      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø«ÙŠÙ… (Ø¯Ø§ÙƒÙ† / ÙØ§ØªØ­)
      const body = document.body;
      const themeToggleBtn = document.getElementById('themeToggle');
      const savedTheme = localStorage.getItem(THEME_KEY);

      if (savedTheme === 'light') {
        body.classList.add('light-mode');
      }

      const updateThemeButtonText = () => {
        if (!themeToggleBtn) return;
        if (body.classList.contains('light-mode')) {
          themeToggleBtn.textContent = 'ğŸŒ™ ÙˆØ¶Ø¹ Ø¯Ø§ÙƒÙ†';
        } else {
          themeToggleBtn.textContent = 'â˜€ï¸ ÙˆØ¶Ø¹ ÙØ§ØªØ­';
        }
      };

      updateThemeButtonText();

      if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', function () {
          body.classList.toggle('light-mode');
          const mode = body.classList.contains('light-mode') ? 'light' : 'dark';
          localStorage.setItem(THEME_KEY, mode);
          updateThemeButtonText();
        });
      }

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
      const loginContainer = document.getElementById('login-container');
      const appContainer   = document.getElementById('app-container');
      const loginForm      = document.getElementById('login-form');

      if (loginForm && loginContainer && appContainer) {
        loginForm.addEventListener('submit', function (e) {
          e.preventDefault();

          const username = document.getElementById('username').value.trim();
          const password = document.getElementById('password').value.trim();

          if (username === 'Reda' && password === '1715') {
            // Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„
            loginContainer.style.display = 'none';
            appContainer.style.display   = 'block';
          } else {
            alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
          }
        });
      }

      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          if (Array.isArray(parsed)) {
            vehicles = parsed;
          }
        } catch (e) {
          vehicles = [];
        }
      }

      const logsStored = localStorage.getItem(WEEKLY_STORAGE_KEY);
      if (logsStored) {
        try {
          const parsedLogs = JSON.parse(logsStored);
          if (Array.isArray(parsedLogs)) {
            weeklyLogs = parsedLogs;
          }
        } catch (e) {
          weeklyLogs = [];
        }
      }

      const form = document.getElementById('vehicle-form');
      if (form) {
        form.addEventListener('submit', handleSubmit);
      }

      const resetBtn = document.getElementById('resetBtn');
      if (resetBtn) {
        resetBtn.addEventListener('click', function () {
          resetForm();
        });
      }

      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', renderTable);
      }

      const statusFilter = document.getElementById('statusFilter');
      if (statusFilter) {
        statusFilter.addEventListener('change', renderTable);
      }

      const weeklyPlateFilter = document.getElementById('weeklyPlateFilter');
      if (weeklyPlateFilter) {
        weeklyPlateFilter.addEventListener('change', renderWeeklyReport);
      }

      const weeklyFromDate = document.getElementById('weeklyFromDate');
      const weeklyToDate = document.getElementById('weeklyToDate');
      if (weeklyFromDate) {
        weeklyFromDate.addEventListener('change', renderWeeklyReport);
      }
      if (weeklyToDate) {
        weeklyToDate.addEventListener('change', renderWeeklyReport);
      }

      renderTable();
      renderWeeklyReport();
    });

function saveVehicles() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(vehicles));
      } catch (e) {
        console.error('Cannot save vehicles to localStorage', e);
      }
    }

    function handleSubmit(event) {
      event.preventDefault();
      const form = event.target;

      const vehicle = {
        plate: form.plateNumber.value.trim(),
        type: form.carType.value.trim(),
        driver: form.driverName.value.trim(),
        department: form.department.value.trim(),
        odometer: Number(form.odometer.value) || 0,
        maintenanceOdometer: form.maintenanceOdometer.value ? Number(form.maintenanceOdometer.value) : 0,
        lastMaintenanceDate: form.lastMaintenanceDate.value,
        nextMaintenanceDate: form.nextMaintenanceDate.value,
        tiresStatus: form.tiresStatus.value,
        insuranceExpiry: form.insuranceExpiry.value,
        licenseExpiry: form.licenseExpiry.value,
        status: form.status.value || 'active',
        notes: form.notes.value.trim()
      };

      if (!vehicle.plate || !vehicle.type || !vehicle.driver) {
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ Ø§Ù„Ø³Ø§Ø¦Ù‚.');
        return;
      }

      const indexValue = form.vehicleIndex.value;
      if (indexValue === '') {
        vehicles.push(vehicle);
      } else {
        const idx = Number(indexValue);
        if (!Number.isNaN(idx) && vehicles[idx]) {
          vehicles[idx] = vehicle;
        }
      }

      saveVehicles();
      resetForm();
      renderTable();
    }

    function resetForm() {
      const form = document.getElementById('vehicle-form');
      if (!form) return;
      form.reset();
      form.vehicleIndex.value = '';
      const title = document.getElementById('form-title');
      const submitBtn = document.getElementById('submit-btn');
      if (title) title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©';
      if (submitBtn) submitBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„Ø³ÙŠØ§Ø±Ø©';
    }

    function renderTable() {
      const tbody = document.querySelector('#vehicles-table tbody');
      if (!tbody) return;
      tbody.innerHTML = '';

      const searchInput = document.getElementById('searchInput');
      const statusFilter = document.getElementById('statusFilter');
      const searchText = searchInput ? searchInput.value.toLowerCase() : '';
      const filterValue = statusFilter ? statusFilter.value : 'all';

      let visibleCount = 0;

      vehicles.forEach(function (v, index) {
        const combined = (v.plate + ' ' + v.type + ' ' + v.driver + ' ' + (v.department || '')).toLowerCase();
        if (searchText && combined.indexOf(searchText) === -1) {
          return;
        }

        const maintenanceInfo = getMaintenanceStatus(v);
        if (filterValue !== 'all' && filterValue !== maintenanceInfo.status) {
          return;
        }

        const tr = document.createElement('tr');
        if (maintenanceInfo.status === 'overdue') {
          tr.classList.add('row-overdue');
        } else if (maintenanceInfo.status === 'near') {
          tr.classList.add('row-near');
        }

        const insuranceHtml = formatExpiry(v.insuranceExpiry);
        const licenseHtml = formatExpiry(v.licenseExpiry);
        const tiresCls = v.tiresStatus ? 'tag-' + v.tiresStatus : 'tag-unknown';

        tr.innerHTML =
          '<td>' + (index + 1) + '</td>' +
          '<td>' + escapeHtml(v.plate) + '</td>' +
          '<td>' + escapeHtml(v.type) + '</td>' +
          '<td>' + escapeHtml(v.driver) + '</td>' +
          '<td>' + (v.odometer || 0) + '</td>' +
          '<td>' + (v.maintenanceOdometer || '-') + '</td>' +
          '<td><span class="status-badge status-' + maintenanceInfo.status + '">' + maintenanceInfo.label + '</span></td>' +
          '<td><span class="tag ' + tiresCls + '">' + tiresLabel(v.tiresStatus) + '</span></td>' +
          '<td>' + insuranceHtml + '</td>' +
          '<td>' + licenseHtml + '</td>' +
          '<td>' + (v.status === 'inactive' ? 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©' : 'Ù†Ø´Ø·Ø©') + '</td>' +
          '<td>' +
          '<button type="button" class="btn btn-small" onclick="printVehicleReport(' + index + ')">PDF</button>' +
          '<button type="button" class="btn btn-small" onclick="editVehicle(' + index + ')">ØªØ¹Ø¯ÙŠÙ„</button>' +
          '<button type="button" class="btn btn-small btn-danger" onclick="deleteVehicle(' + index + ')">Ø­Ø°Ù</button>' +
          '</td>';

        tbody.appendChild(tr);
        visibleCount++;
      });

      if (visibleCount === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td class="empty-row" colspan="12">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</td>';
        tbody.appendChild(tr);
      }

      renderSummary();
    }

    function renderSummary() {
      const totalEl = document.getElementById('total-count');
      const overdueEl = document.getElementById('overdue-count');
      const nearEl = document.getElementById('near-count');
      if (!totalEl || !overdueEl || !nearEl) return;

      let overdue = 0;
      let near = 0;

      vehicles.forEach(function (v) {
        const status = getMaintenanceStatus(v).status;
        if (status === 'overdue') overdue++;
        else if (status === 'near') near++;
      });

      totalEl.textContent = vehicles.length;
      overdueEl.textContent = overdue;
      nearEl.textContent = near;
    }

    function getMaintenanceStatus(v) {
      let status = 'unknown';
      let label = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

      const hasKm = typeof v.maintenanceOdometer === 'number' && v.maintenanceOdometer > 0;
      const hasDate = !!v.nextMaintenanceDate;

      if (!hasKm && !hasDate) {
        return { status: status, label: label };
      }

      status = 'ok';
      label = 'Ø³Ù„ÙŠÙ…';

      let kmDiff = null;
      if (hasKm) {
        kmDiff = v.maintenanceOdometer - (v.odometer || 0);
      }

      let dateDiff = null;
      if (hasDate) {
        const next = new Date(v.nextMaintenanceDate);
        if (!isNaN(next.getTime())) {
          const today = new Date();
          dateDiff = Math.ceil((next.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
        }
      }

      if ((kmDiff !== null && kmDiff <= 0) || (dateDiff !== null && dateDiff <= 0)) {
        status = 'overdue';
        label = 'Ù…ØªØ£Ø®Ø±';
      } else if ((kmDiff !== null && kmDiff <= 1000) || (dateDiff !== null && dateDiff <= 30)) {
        status = 'near';
        label = 'Ù‚Ø±ÙŠØ¨Ø©';
      }

      return { status: status, label: label };
    }

    function getExpiryStatus(dateStr) {
      if (!dateStr) {
        return { status: 'unknown', label: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' };
      }
      const exp = new Date(dateStr);
      if (isNaN(exp.getTime())) {
        return { status: 'unknown', label: dateStr };
      }
      const today = new Date();
      const diffDays = Math.ceil((exp.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
      if (diffDays < 0) {
        return { status: 'overdue', label: 'Ù…Ù†ØªÙ‡ÙŠ' };
      }
      if (diffDays <= 30) {
        return { status: 'near', label: 'Ù‚Ø±Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡' };
      }
      return { status: 'ok', label: 'Ø³Ø§Ø±ÙŠ' };
    }

    function formatExpiry(dateStr) {
      const info = getExpiryStatus(dateStr);
      if (!dateStr) {
        return '<span class="status-badge status-' + info.status + '">' + info.label + '</span>';
      }
      return (
        '<div>' +
        '<span class="status-badge status-' + info.status + '">' + info.label + '</span>' +
        '<div class="small-date">' + dateStr + '</div>' +
        '</div>'
      );
    }

    function tiresLabel(value) {
      if (value === 'good') return 'Ø¬ÙŠØ¯Ø©';
      if (value === 'check') return 'ØªØ­ØªØ§Ø¬ ÙØ­Øµ';
      if (value === 'replace') return 'ØªØ­ØªØ§Ø¬ ØªØºÙŠÙŠØ±';
      return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    }

    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/[&<>"']/g, function (m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        }[m] || m;
      });
    }

    function editVehicle(index) {
      const v = vehicles[index];
      const form = document.getElementById('vehicle-form');
      if (!v || !form) return;

      form.vehicleIndex.value = String(index);
      form.plateNumber.value = v.plate || '';
      form.carType.value = v.type || '';
      form.driverName.value = v.driver || '';
      form.department.value = v.department || '';
      form.odometer.value = v.odometer || 0;
      form.maintenanceOdometer.value = v.maintenanceOdometer || '';
      form.lastMaintenanceDate.value = v.lastMaintenanceDate || '';
      form.nextMaintenanceDate.value = v.nextMaintenanceDate || '';
      form.tiresStatus.value = v.tiresStatus || '';
      form.insuranceExpiry.value = v.insuranceExpiry || '';
      form.licenseExpiry.value = v.licenseExpiry || '';
      form.status.value = v.status || 'active';
      form.notes.value = v.notes || '';

      const title = document.getElementById('form-title');
      const submitBtn = document.getElementById('submit-btn');
      if (title) title.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±Ø©';
      if (submitBtn) submitBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';

      form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function getDefaultSunday() {
      const today = new Date();
      const day = today.getDay();
      const diffToSunday = day === 0 ? 0 : day;
      const sunday = new Date(today);
      sunday.setDate(today.getDate() - diffToSunday);
      return sunday.toISOString().slice(0, 10);
    }

    function openWeeklyModal() {
      const modal = document.getElementById('weekly-modal');
      const tbody = document.querySelector('#weekly-table tbody');
      const dateInput = document.getElementById('weeklyDate');
      if (!modal || !tbody || !dateInput) return;

      tbody.innerHTML = '';

      const activeVehicles = vehicles.filter(function (v) {
        return v.status !== 'inactive';
      });

      activeVehicles.forEach(function (v, idx) {
        const tr = document.createElement('tr');
        tr.innerHTML =
          '<td>' + (idx + 1) + '</td>' +
          '<td>' + escapeHtml(v.plate || '') + '</td>' +
          '<td>' + escapeHtml(v.type || '') + '</td>' +
          '<td>' + escapeHtml(v.driver || '') + '</td>' +
          '<td>' + (v.odometer || 0) + '</td>' +
          '<td><input type="number" min="0" step="1" data-index="' + idx + '" /></td>';
        tbody.appendChild(tr);
      });

      dateInput.value = getDefaultSunday();
      modal.style.display = 'flex';
    }

    function closeWeeklyModal() {
      const modal = document.getElementById('weekly-modal');
      if (modal) modal.style.display = 'none';
    }

    function persistWeeklyLogs() {
      try {
        localStorage.setItem(WEEKLY_STORAGE_KEY, JSON.stringify(weeklyLogs));
      } catch (e) {
        console.error('Cannot save weekly logs', e);
      }
    }

    function findLastOdometerForPlate(plate) {
      for (let i = weeklyLogs.length - 1; i >= 0; i--) {
        if (weeklyLogs[i].plate === plate && typeof weeklyLogs[i].odometer === 'number') {
          return weeklyLogs[i].odometer;
        }
      }
      return null;
    }

    function saveWeeklyLogs() {
      const dateInput = document.getElementById('weeklyDate');
      const tbody = document.querySelector('#weekly-table tbody');
      if (!dateInput || !tbody) return;

      const dateStr = dateInput.value;
      if (!dateStr) {
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.');
        return;
      }

      const inputs = tbody.querySelectorAll('input[type="number"]');
      const activeVehicles = vehicles.filter(function (v) {
        return v.status !== 'inactive';
      });

      let count = 0;

      inputs.forEach(function (input) {
        const idx = Number(input.getAttribute('data-index'));
        if (Number.isNaN(idx) || !activeVehicles[idx]) return;
        const value = input.value;
        if (!value) return;

        const newOdo = Number(value);
        if (Number.isNaN(newOdo) || newOdo < 0) return;

        const v = activeVehicles[idx];
        const plate = v.plate || '';
        const lastOdo = findLastOdometerForPlate(plate);
        let delta = null;
        if (lastOdo !== null && newOdo >= lastOdo) {
          delta = newOdo - lastOdo;
        }

        weeklyLogs.push({
          plate: plate,
          type: v.type || '',
          driver: v.driver || '',
          date: dateStr,
          odometer: newOdo,
          deltaKm: delta
        });

        const originalIndex = vehicles.indexOf(v);
        if (originalIndex !== -1) {
          vehicles[originalIndex].odometer = newOdo;
        }

        count++;
      });

      if (!count) {
        alert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ù‚Ø±Ø§Ø¡Ø§Øª.');
        return;
      }

      saveVehicles();
      persistWeeklyLogs();
      renderTable();
      closeWeeklyModal();
      alert('ØªÙ… Ø­ÙØ¸ ' + count + ' Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­ Ù„ÙŠÙˆÙ… ' + dateStr + '.');
    }

    function getFilteredWeeklyLogs() {
      const plateSelect = document.getElementById('weeklyPlateFilter');
      const fromInput = document.getElementById('weeklyFromDate');
      const toInput = document.getElementById('weeklyToDate');
      if (!plateSelect || !fromInput || !toInput) return [];

      const selectedPlate = plateSelect.value || 'all';
      const fromDate = fromInput.value;
      const toDate = toInput.value;

      const logs = weeklyLogs.slice().sort(function (a, b) {
        if (!a || !b) return 0;
        if (a.date === b.date) {
          if (a.plate === b.plate) return 0;
          return a.plate > b.plate ? 1 : -1;
        }
        return a.date < b.date ? 1 : -1;
      });

      const filtered = [];
      logs.forEach(function (log) {
        if (!log || !log.date) return;
        if (selectedPlate !== 'all' && log.plate !== selectedPlate) return;
        if (fromDate && log.date < fromDate) return;
        if (toDate && log.date > toDate) return;
        filtered.push(log);
      });

      return filtered;
    }

    function renderWeeklyReport() {
      const tbody = document.querySelector('#weekly-report-table tbody');
      const plateSelect = document.getElementById('weeklyPlateFilter');
      if (!tbody || !plateSelect) return;

      const previousValue = plateSelect.value || 'all';

      // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
      const uniqueMap = new Map();
      weeklyLogs.forEach(function (log) {
        if (!log || !log.plate) return;
        if (!uniqueMap.has(log.plate)) {
          uniqueMap.set(log.plate, { type: log.type || '', driver: log.driver || '' });
        }
      });

      plateSelect.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>';
      uniqueMap.forEach(function (info, plate) {
        const opt = document.createElement('option');
        opt.value = plate;
        let label = plate;
        if (info.type) label += ' - ' + info.type;
        if (info.driver) label += ' - ' + info.driver;
        opt.textContent = label;
        plateSelect.appendChild(opt);
      });

      if (previousValue && (previousValue === 'all' || uniqueMap.has(previousValue))) {
        plateSelect.value = previousValue;
      } else {
        plateSelect.value = 'all';
      }

      const filtered = getFilteredWeeklyLogs();

      tbody.innerHTML = '';
      if (!filtered.length) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="7" class="empty-row">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø¡Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</td>';
        tbody.appendChild(tr);
        return;
      }

      filtered.forEach(function (log, idx) {
        const tr = document.createElement('tr');
        tr.innerHTML =
          '<td>' + (idx + 1) + '</td>' +
          '<td>' + log.date + '</td>' +
          '<td>' + escapeHtml(log.plate || '') + '</td>' +
          '<td>' + escapeHtml(log.type || '') + '</td>' +
          '<td>' + escapeHtml(log.driver || '') + '</td>' +
          '<td>' + (typeof log.odometer === 'number' ? log.odometer : '-') + '</td>' +
          '<td>' + (typeof log.deltaKm === 'number' ? log.deltaKm : '-') + '</td>';
        tbody.appendChild(tr);
      });
    }

    function printWeeklyReport() {
      const logs = getFilteredWeeklyLogs();
      if (!logs.length) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø¡Ø§Øª Ù„Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ±.');
        return;
      }

      const now = new Date().toLocaleString('ar-EG');

      let rows = '';
      logs.forEach(function (log, idx) {
        rows += '<tr>' +
          '<td>' + (idx + 1) + '</td>' +
          '<td>' + log.date + '</td>' +
          '<td>' + escapeHtml(log.plate || '') + '</td>' +
          '<td>' + escapeHtml(log.type || '') + '</td>' +
          '<td>' + escapeHtml(log.driver || '') + '</td>' +
          '<td>' + (typeof log.odometer === 'number' ? log.odometer : '-') + '</td>' +
          '<td>' + (typeof log.deltaKm === 'number' ? log.deltaKm : '-') + '</td>' +
        '</tr>';
      });

      const win = window.open('', '_blank');
      if (!win) return;

      win.document.write(`<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªÙ‚Ø±ÙŠØ± Ù‚Ø±Ø§Ø¡Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma,sans-serif; margin: 20px; direction: rtl; }
    h1 { font-size: 20px; margin-bottom: 4px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: right; font-size: 12px; }
    th { background: #f3f4f6; }
    .meta { font-size: 12px; color: #666; margin-top: 8px; }
  
    .site-footer {
      margin-top: 2rem;
      border-top: 1px solid #1f2937;
      padding: 1rem 0.75rem;
      font-size: 0.9rem;
      text-align: center;
      color: #9ca3af;
    }
    body.light-mode .site-footer {
      border-top-color: #e5e7eb;
      color: #6b7280;
    }

  </style>
</head>
<body onload="window.print()">
  <h1>ØªÙ‚Ø±ÙŠØ± Ù‚Ø±Ø§Ø¡Ø§Øª Ø¹Ø¯Ø§Ø¯ ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯</h1>
  <div class="meta">ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${now}</div>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
        <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
        <th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
        <th>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (ÙƒÙ…)</th>
        <th>Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø¢Ø®Ø± Ù‚Ø±Ø§Ø¡Ø© (ÙƒÙ…)</th>
      </tr>
    </thead>
    <tbody>
      ${rows}
    </tbody>
  </table>
  </div>

  <footer class="site-footer">
    <div class="container">Designed by Mohamed Lasheen</div>
  </footer>

</body>
</html>`);
      win.document.close();
    }

    function clearWeeklyLogsWithPassword() {
      const pwd = prompt('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯:');
      if (pwd === null) return;
      if (pwd !== '0000') {
        alert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.');
        return;
      }
      if (!confirm('ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± Ù‚Ø±Ø§Ø¡Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡Ø§. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
        return;
      }
      weeklyLogs = [];
      persistWeeklyLogs();
      renderWeeklyReport();
      alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± Ù‚Ø±Ø§Ø¡Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯ Ø¨Ù†Ø¬Ø§Ø­.');
    }


    function deleteVehicle(index) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ')) return;
      vehicles.splice(index, 1);
      saveVehicles();
      renderTable();
    }

    function printVehicleReport(index) {
      const v = vehicles[index];
      if (!v) return;

      const win = window.open('', '_blank');
      if (!win) return;

      const now = new Date().toLocaleString('ar-EG');

      const maintenanceInfo = getMaintenanceStatus(v);
      const insuranceInfo = getExpiryStatus(v.insuranceExpiry);
      const licenseInfo = getExpiryStatus(v.licenseExpiry);
      const tires = tiresLabel(v.tiresStatus);

      win.document.write(`<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªÙ‚Ø±ÙŠØ± Ø³ÙŠØ§Ø±Ø© - ${escapeHtml(v.plate || '')}</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma,sans-serif; margin: 20px; direction: rtl; }
    h1 { font-size: 20px; margin-bottom: 4px; }
    h2 { font-size: 16px; margin-top: 0; color: #555; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: right; font-size: 13px; }
    th { background: #f3f4f6; }
    .meta { font-size: 12px; color: #666; margin-top: 8px; }
  
    .site-footer {
      margin-top: 2rem;
      border-top: 1px solid #1f2937;
      padding: 1rem 0.75rem;
      font-size: 0.9rem;
      text-align: center;
      color: #9ca3af;
    }
    body.light-mode .site-footer {
      border-top-color: #e5e7eb;
      color: #6b7280;
    }

  </style>
</head>
<body onload="window.print()">
  <h1>ØªÙ‚Ø±ÙŠØ± Ø³ÙŠØ§Ø±Ø©</h1>
  <h2>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©: ${escapeHtml(v.plate || '')}</h2>
  <div class="meta">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${now}</div>
  <table>
    <tbody>
      <tr><th>Ù†ÙˆØ¹ / Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><td>${escapeHtml(v.type || '')}</td></tr>
      <tr><th>Ø§Ù„Ø³Ø§Ø¦Ù‚ / ØµØ§Ø­Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><td>${escapeHtml(v.driver || '')}</td></tr>
      <tr><th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© / Ø§Ù„Ù‚Ø³Ù…</th><td>${escapeHtml(v.department || '')}</td></tr>
      <tr><th>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒÙ…)</th><td>${v.odometer || 0}</td></tr>
      <tr><th>Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (ÙƒÙ…)</th><td>${v.maintenanceOdometer || '-'}</td></tr>
      <tr><th>Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</th><td>${maintenanceInfo.label}</td></tr>
      <tr><th>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØµÙŠØ§Ù†Ø©</th><td>${v.lastMaintenanceDate || '-'}</td></tr>
      <tr><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</th><td>${v.nextMaintenanceDate || '-'}</td></tr>
      <tr><th>Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§ÙˆØªØ´</th><td>${tires}</td></tr>
      <tr><th>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ£Ù…ÙŠÙ†</th><td>${v.insuranceExpiry || '-'} (${insuranceInfo.label})</td></tr>
      <tr><th>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø±Ø®ØµØ©</th><td>${v.licenseExpiry || '-'} (${licenseInfo.label})</td></tr>
      <tr><th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><td>${v.status === 'inactive' ? 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©' : 'Ù†Ø´Ø·Ø©'}</td></tr>
      <tr><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><td>${escapeHtml(v.notes || '')}</td></tr>
    </tbody>
  </table>

  <footer class="site-footer">
    <div class="container">Designed by Mohamed Lasheen</div>
  </footer>

</body>
</html>`);
      win.document.close();
    }

    function printAllVehicles() {
      if (!vehicles.length) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ù„Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ±.');
        return;
      }

      const now = new Date().toLocaleString('ar-EG');
      let rows = '';

      vehicles.forEach(function (v, index) {
        const maintenanceInfo = getMaintenanceStatus(v);
        const tires = tiresLabel(v.tiresStatus);
        const insurance = v.insuranceExpiry || '-';
        const license = v.licenseExpiry || '-';

        rows += '<tr>' +
          '<td>' + (index + 1) + '</td>' +
          '<td>' + escapeHtml(v.plate || '') + '</td>' +
          '<td>' + escapeHtml(v.type || '') + '</td>' +
          '<td>' + escapeHtml(v.driver || '') + '</td>' +
          '<td>' + (v.odometer || 0) + '</td>' +
          '<td>' + (v.maintenanceOdometer || '-') + '</td>' +
          '<td>' + maintenanceInfo.label + '</td>' +
          '<td>' + tires + '</td>' +
          '<td>' + insurance + '</td>' +
          '<td>' + license + '</td>' +
          '<td>' + (v.status === 'inactive' ? 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©' : 'Ù†Ø´Ø·Ø©') + '</td>' +
        '</tr>';
      });

      const win = window.open('', '_blank');
      if (!win) return;

      win.document.write(`<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªÙ‚Ø±ÙŠØ± ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma,sans-serif; margin: 20px; direction: rtl; }
    h1 { font-size: 20px; margin-bottom: 4px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: right; font-size: 12px; }
    th { background: #f3f4f6; }
    .meta { font-size: 12px; color: #666; margin-top: 8px; }
  
    .site-footer {
      margin-top: 2rem;
      border-top: 1px solid #1f2937;
      padding: 1rem 0.75rem;
      font-size: 0.9rem;
      text-align: center;
      color: #9ca3af;
    }
    body.light-mode .site-footer {
      border-top-color: #e5e7eb;
      color: #6b7280;
    }

  </style>
</head>
<body onload="window.print()">
  <h1>ØªÙ‚Ø±ÙŠØ± ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h1>
  <div class="meta">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${now}</div>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
        <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
        <th>Ø§Ù„Ø³Ø§Ø¦Ù‚ / ØµØ§Ø­Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
        <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒÙ…)</th>
        <th>Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (ÙƒÙ…)</th>
        <th>Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</th>
        <th>Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§ÙˆØªØ´</th>
        <th>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
        <th>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø±Ø®ØµØ©</th>
        <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
      </tr>
    </thead>
    <tbody>
      ${rows}
    </tbody>
  </table>

  <footer class="site-footer">
    <div class="container">Designed by Mohamed Lasheen</div>
  </footer>

</body>
</html>`);
      win.document.close();
    }
  
    function exportJson() {
      const data = {
        vehicles: vehicles,
        weeklyLogs: weeklyLogs
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], {
        type: 'application/json'
      });

      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const today = new Date().toISOString().slice(0, 10);

      a.href = url;
      a.download = 'fleet-backup-' + today + '.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importJsonFile(event) {
      const file = event.target.files && event.target.files[0];
      if (!file) return;

      const reader = new FileReader();

      reader.onload = function (e) {
        try {
          const json = JSON.parse(e.target.result);

          if (Array.isArray(json)) {
            vehicles = json;
          } else if (json && typeof json === 'object') {
            vehicles = Array.isArray(json.vehicles) ? json.vehicles : [];
            weeklyLogs = Array.isArray(json.weeklyLogs) ? json.weeklyLogs : [];
          } else {
            throw new Error('Bad format');
          }

          saveVehicles();
          persistWeeklyLogs();
          renderTable();
          renderWeeklyReport();

          alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
        } catch (err) {
          console.error('Import error', err);
          alert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© JSON ØµØ­ÙŠØ­Ø© ÙˆØ¨Ù†ÙØ³ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬.');
        } finally {
          event.target.value = '';
        }
      };

      reader.readAsText(file, 'utf-8');
    }

</script>

  <footer class="site-footer">
    <div class="container">Designed by Mohamed Lasheen</div>
  </footer>

</body>
</html>
